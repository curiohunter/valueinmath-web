# 학원 관리 프로그램 진행 상황

## 프로젝트 개요
- **프로젝트명**: 학원 관리 시스템
- **목적**: 학생 정보 관리 및 학원 운영 효율화
- **시작일**: 2023년 5월 22일

## 완료된 기능
- [x] 기본 UI 구조 및 레이아웃 설정
- [x] 학생 목록 조회 및 필터링
- [x] 학생 등록/수정/삭제 기능
- [x] 학생 상태별 색상 구분 (재원, 퇴원, 휴원, 미등록)
- [x] 담당관별 색상 구분 (고등관, 중등관, 영재관)
- [x] 학생 메모 기능 구현
- [x] 종료일 필드 추가 및 Supabase 연동
- [x] 퇴원 상태 학생의 종료일 필수 검증
- [x] 검색 기능 개선
- [x] 직원 관리 기능 구현
  - [x] 직원 목록 조회 및 필터링
  - [x] 직원 등록/수정/삭제 기능
  - [x] 직원 상태별 색상 구분 (재직, 퇴직)
  - [x] 직책별 색상 구분 (원장, 부원장, 강사, 데스크직원, 데스크보조)
  - [x] 직원 메모 기능 구현
- [x] 반 관리 기능 구현
  - [x] 반 목록 조회 및 담당선생님/과목별 필터링
  - [x] 반 등록/수정/삭제 기능
  - [x] 반별 학생 목록 표시 및 관리
  - [x] 담당선생님 필터(원장/강사만), 과목 필터, UI/UX 학생관리와 통일
  - [x] 반 상세 모달에서 학생 목록, 담당선생님, 수정/삭제/닫기 버튼 UI 개선
  - [x] shadcn/tailwind/card/border/shadow 등 스타일 통일
- [x] UI 개선
  - [x] 테이블 컬럼 정렬 문제 수정
  - [x] 메모와 관리 열 가운데 정렬 적용
  - [x] 반/학생/직원 관리 페이지 상단탭, 필터, 버튼, 테이블, 모달 등 UI/UX 통일
  - [x] 불필요한 검색 인풋/버튼 제거, 필터/버튼만 남기고 정렬
- [x] 인증 기능 추가
  - [x] 로그인/회원가입 페이지 구현
  - [x] 비밀번호 재설정 기능 구현
  - [x] 인증 미들웨어 설정
  - [x] 직원과 사용자 계정 연결 기능 구현
  - [x] 사용자 프로필 테이블 생성 및 관리
  - [x] 새 사용자 등록 시 프로필 자동 생성 트리거 추가
  - [x] 프로필 테이블에 이메일 필드 추가 및 동기화 트리거 구현
  - [x] 기존 사용자를 위한 프로필 생성
  - [x] 회원 탈퇴(계정 삭제) 기능 구현 (user, profiles 삭제 및 /login 리디렉션)
- [x] 팀 채팅 기능 구현 (기본 기능)
  - [x] 채팅 데이터베이스 스키마 설계 및 생성
  - [x] 채팅방 생성 및 관리 기능
  - [x] 메시지 전송 및 수신 기능
  - [x] 계정 연결된 직원만 멤버로 선택 가능
  - [x] 메시지 읽음 상태 관리
  - [x] 사이드바에 채팅 메뉴 추가
  - [x] 회원 탈퇴 시 user, profiles 삭제 및 /login 리디렉션 처리 완료
- [x] n8n 기반 에이전트(챗봇) 연동 및 실전 구조 개선
  - [x] n8n Webhook URL 환경변수 관리 및 보안 적용
  - [x] TeddyFlow 스타일의 멀티 챗봇/대화 목록/대화창 UI(MultiChat) 구현
  - [x] 프론트엔드 fetch 경로 자동 변환(`/api/n8n/...` 프록시)로 CORS 문제 완전 해결
  - [x] Next.js rewrites 설정으로 로컬/운영 환경 모두 same-origin 개발 구조 완성
  - [x] CORS 헤더 중복 문제 실전 디버깅 및 프록시/서버 환경변수 최적화
  - [x] 채팅 입력창 UX 개선(하단 고정, 메시지 반영 패턴 개선)
  - [x] 반복 피드백 기반 구조/UX/코드 리팩토링 및 상세 설명 제공
  - [x] 채팅/에이전트/메시지 삭제 시 DB 연쇄 삭제(FK + ON DELETE CASCADE) 적용
  - [x] MultiChat 컴포넌트 구조/레이아웃/스크롤/높이 고정 등 UI/UX 개선
  - [x] 채팅방/에이전트/메시지 실시간 동기화 및 삭제 동작 실전 검증
  - [x] Supabase RLS 정책/권한 문제 실전 점검 및 안내
  - [x] 실전 디버깅(삭제, 실시간, CORS, fetch, 프록시 등) 및 코드 품질 개선
  - [x] 최신 Claude Sonnet4와의 협업 및 실전 피드백 반영
- [x] 팀 채팅 고급 기능
  - [ ] 파일 첨부 기능
  - [ ] 메시지 편집/삭제 기능
  - [ ] 알림 기능
- [x] 수업 일정 관리 기능
- [x] 학습 관리 기능 (진행 예정)
- [x] 통계 분석 기능
- [x] 에이전트(챗봇) 채팅 UI 고도화
  - [ ] 멀티 챗봇 UX 개선
  - [ ] 대화 목록/탭 UX 고도화
  - [ ] 메시지 버블, 시간, 이름, 상태 등 시각적 개선
  - [ ] 첨부파일, 이미지, 링크 등 확장 지원
  - [ ] 모바일/반응형 최적화
- [x] 시험 관리 테이블 UI/UX 고도화
  - [x] 학생별 시험 행 추가 UX(이름 옆 플러스 버튼, 자동 행 추가)
  - [x] 컬럼 너비/정렬/입력창/카드/이모지 안내 등 실무형 UI 개선
  - [x] 플러스 버튼 카드화, 클릭 영역 확대, 입력창/삭제/일괄적용 등 UX 통일
  - [x] 반/이름/날짜/특이사항 등 컬럼별 가로폭 실사용 기준 최적화
  - [x] 실시간 행 추가/삭제/입력/저장 동작 및 오류 처리 개선

## 예정된 기능
- [ ] 대시보드 페이지 구현
  - [ ] 학생 통계 (상태별, 담당관별)
  - [ ] 직원 통계 (직책별, 부서별)
  - [ ] 최근 등록/퇴원 학생 목록
  - [ ] 월별 등록/퇴원 추이 그래프
- [ ] 엑셀 내보내기/가져오기 기능
  - [ ] 학생 목록 엑셀 내보내기
  - [ ] 직원 목록 엑셀 내보내기
  - [ ] 엑셀 파일에서 학생/직원 정보 가져오기
- [ ] 모바일 반응형 개선
  - [ ] 테이블 모바일 최적화
  - [ ] 폼 모바일 최적화
- [ ] 팀 채팅 고급 기능
  - [ ] 파일 첨부 기능
  - [ ] 메시지 편집/삭제 기능
  - [ ] 알림 기능
- [ ] 수업 일정 관리 기능
- [ ] 학습 관리 페이지 구현 (다음 작업)
- [ ] 통계 분석 기능
- [ ] 에이전트(챗봇) 채팅 UI 고도화
  - [ ] 멀티 챗봇 UX 개선
  - [ ] 대화 목록/탭 UX 고도화
  - [ ] 메시지 버블, 시간, 이름, 상태 등 시각적 개선
  - [ ] 첨부파일, 이미지, 링크 등 확장 지원
  - [ ] 모바일/반응형 최적화

## 이슈 및 해결된 문제
- ✅ 퇴원 학생 종료일 필수 검증 개선 완료
- ✅ 검색 기능 작동 문제 해결 완료
- ✅ 전체 검색 바 제거 완료
- ✅ 담당관에서 "과학" 옵션 제거 완료
- ✅ 테이블 컬럼 정렬 문제 해결 완료
- ✅ 메모와 관리 열 가운데 정렬 적용 완료
- ✅ 직원 관리에서 불필요한 부서 필터 제거 완료
- ✅ 직원과 사용자 계정 연결 기능 구현 완료
- ✅ 사용자 프로필 테이블 생성 및 관리 완료
- ✅ 새 사용자 등록 시 프로필 자동 생성 트리거 추가 완료
- ✅ 프로필 테이블에 이메일 필드 추가 및 동기화 트리거 구현 완료
- ✅ 팀 채팅 기능 구현 완료
- ✅ 채팅방 멤버 선택 시 계정 연결된 직원만 표시되도록 수정 완료
- ✅ n8n 기반 에이전트 챗봇 연동 및 CORS/프록시 구조 개선 완료
- ✅ 채팅/에이전트/메시지 삭제 시 DB 연쇄 삭제(FK + ON DELETE CASCADE) 적용 완료
- ✅ MultiChat 컴포넌트 구조/레이아웃/스크롤/높이 고정 등 UI/UX 개선 완료
- ✅ 채팅방/에이전트/메시지 실시간 동기화 및 삭제 동작 실전 검증 완료
- ✅ Supabase RLS 정책/권한 문제 실전 점검 및 안내 완료
- ✅ 실전 디버깅(삭제, 실시간, CORS, fetch, 프록시 등) 및 코드 품질 개선 완료
- ✅ 최신 Claude Sonnet4와의 협업 및 실전 피드백 반영 완료

## 다음 작업 우선순위
1. 학습 관리 페이지 구현
2. 에이전트(챗봇) 채팅 UI 고도화 (멀티 챗봇 UX, 메시지 버블, 시간/이름/상태 표시, 반응형 등)
3. 채팅 UI 개선 - 메시지 위치, 스크롤 위치, 이름 표시, 시간 표시 문제 해결
4. 메모장 자동 저장 기능 추가
5. 인증 컨텍스트 구현
6. 권한 기반 접근 제어 구현
7. 학생 상세 페이지 구현
8. 대시보드 페이지 구현
9. 엑셀 내보내기/가져오기 기능
10. 모바일 반응형 개선

## 마지막 업데이트
- 날짜: 2025년 5월 26일
- 작업: 시험 관리 테이블 UI/UX 고도화(플러스 버튼, 컬럼 너비, 입력창, 카드/이모지 안내, 실시간 행 추가/삭제/입력/저장 등 실무형 UX 개선) 완료. 다음 작업은 수업 일정(학원 일정) 페이지 구현 예정.

## DB 스키마 업데이트시 
-  supabase gen types typescript --project-id <프로젝트ID> --schema public > types/database.ts

## 깃허브 커밋
  git add .
  git commit -m "작업 내용"
  git push

## 챗봇/AI 워크플로우(n8n) 연동 계획

### 구현 순서
1. n8n에서 Chat Webhook(When Chat Message Received 노드) 준비 및 CORS/인증 설정
2. Next.js(홈페이지)에 채팅 UI(메시지 입력/출력) 컴포넌트 구현
3. 프론트엔드에서 n8n Webhook API 연동(메시지 전송/응답 표시)
4. n8n 워크플로우 설계(LLM, DB, 자동화 등 자유롭게 조합)
5. 인증/보안 처리(Basic Auth, .env, CORS 등)
6. 배포 및 실서비스 적용(https, 환경변수, 실서버 연동)

### 구현시 주의사항
- n8n Webhook URL, 인증 정보 등은 반드시 .env에 보관(절대 커밋 금지)
- CORS 설정: 홈페이지 도메인 또는 * 허용 필요
- 인증 필요시 Basic Auth 등 적용, fetch에서 헤더 추가
- n8n 서버는 외부에서 접근 가능해야 함(https 권장)
- 민감 정보, API Key 등은 .gitignore로 보호
- 워크플로우 확장 시 n8n에서 LLM, DB, 이메일, 알림 등 자유롭게 조합 가능

### 참고 라이브러리/기술
- 채팅 UI: react-chat-ui, shadcn/ui Dialog/List, 직접 구현 등
- API 연동: fetch, axios 등
- LLM 연동: n8n OpenAI, Claude, HuggingFace 노드 등
- 자동화: n8n 내 다양한 노드(DB, 메일, 슬랙 등)

---

## UI/UX 통일 가이드라인 (필수 참고사항)

- **공통 컴포넌트**: 상단 탭, 필터/검색/등록 버튼, 테이블, 모달, 카드 등은 반드시 공통 컴포넌트로 분리하여 재사용
- **버튼**: shadcn/ui Button 컴포넌트 사용, primary/outline/error 등 명확한 스타일 구분, 이모지+텍스트 조합 권장, 크기/여백/폰트 일관성 유지
- **헤더/상단**: 페이지 제목, 탭, 필터/버튼 한 줄 정렬, 좌우 여백/정렬 통일, 불필요한 요소 최소화
- **카드/테이블**: shadcn/ui Card/Table 컴포넌트 사용, border/shadow/rounded 등 스타일 통일, 컬럼/행 정렬 일관성, 상태/직책/담당관 등은 badge로 시각화
- **모달**: shadcn/ui Dialog 사용, 제목/내용/버튼 구조 통일, 닫기/저장/삭제 등 버튼 우측 정렬, 배경 어둡게 처리
- **컬러/폰트**: Tailwind 프리셋 컬러 사용, 상태/직책/구분 등은 badge 색상 통일, 폰트 크기/굵기/간격 일관성
- **여백/정렬**: Tailwind spacing 유틸리티로 상하좌우 여백 통일, flex/grid로 정렬, 모바일 대응 고려
- **아이콘/이모지**: 버튼/상태/액션에 이모지 또는 Lucide 아이콘 활용, 의미 명확히 전달
- **반응형**: 모바일/태블릿 대응 필수, 테이블/폼/모달 등 최소한의 반응형 구조 적용
- **코드 구조**: DRY 원칙, 중복 최소화, 재사용성 높은 구조로 구현
- **디자인 참고**: 매쓰플랫/샤드cn 스타일을 기본 레퍼런스로 삼고, 신규 UI는 기존 스타일과 반드시 비교 후 적용
- **리뷰/테스트**: PR/리뷰 시 UI 통일성, 여백, 컬러, 버튼 위치 등 반드시 체크

> 위 가이드라인은 모든 신규/기존 페이지, 컴포넌트, 기능 구현 시 반드시 준수해야 하며, 통일성 미흡 시 리팩토링/수정이 요구됩니다.

앞으로 위 순서대로 하나씩 차근차근 구현할 예정입니다. 각 단계별로 상세 구현 및 코드를 기록/공유합니다.

## 마지막 업데이트
- 날짜: 2025년 5월 26일
- 작업: 시험 관리 테이블 UI/UX 고도화(플러스 버튼, 컬럼 너비, 입력창, 카드/이모지 안내, 실시간 행 추가/삭제/입력/저장 등 실무형 UX 개선) 완료. 다음 작업은 수업 일정(학원 일정) 페이지 구현 예정.

## 반 만들기 모달 UI/UX 고도화 및 통일 작업 완료
  - shadcn/ui, tailwind, 공통 Card/Accordion/Button 적극 활용, 매쓰플랫 스타일 참고, DRY 원칙 준수
  - 선생님/학생 검색, 선택, 학년별 아코디언 그룹핑, 전체 추가, 선택된 항목 badge/card 스타일 등 실무형 UX 구현
  - 학생은 status가 '재원'인 학생만, school_type+grade로 그룹핑, 가나다순 정렬, 학년 전체 추가 버튼, 중복 없이 추가, button 중첩(hydration error) 해결
  - 학년명/명수/플러스 버튼/토글 한 줄 정렬, 고정 너비, 간격, 버튼 크기 등 디테일 개선
  - Supabase students 테이블 status, school_type, grade 등 필드 select 및 타입 동기화, status 값 trim/includes로 유연하게 필터링, 콘솔 디버깅
  - form submit, button 중첩, 전체 추가 setState 문제 등 실전 버그 반복 해결
  - types/database.ts 최신화, DB 스키마/타입 점검, 콘솔 에러/경고 해결
  - +/X 버튼: 원형, 컬러, 아이콘, hover 효과, 크기 통일, 선택된 학생/선생님 badge/card 스타일, border, bg, flex-wrap, 구분감 강조
  - 학년명/명수/플러스 버튼/토글: 한 줄 정렬, 고정 너비, 간격, 줄 맞춤, 실무형 UI로 개선
  - 전체적으로 매쓰플랫 스타일에 근접하도록 반복적으로 디테일 개선
  - PROJECT_STATUS.md에 진행상황, UI/UX 통일 가이드라인, 디자인 규칙, 유지보수 전략 등 상세 기록
  - 모든 신규/기존 페이지, 컴포넌트, 기능 구현 시 UI/UX 가이드라인 필수 준수

## 다음 작업: 학습 관리 페이지 구현 예정
  - 실제 학습 데이터(출결, 과제, 수업집중도, 특이사항 등)와 테스트 데이터(단원/서술형/오답/학교기출/총괄 등) 예시 확보
  - 실무에서 사용하는 데이터 구조를 바탕으로 학습 관리 DB/타입/입력/조회/통계 UI 설계 및 구현 예정